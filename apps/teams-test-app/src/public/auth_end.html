<!DOCTYPE html>
<html>
  <head>
    <h2 style="font-size: 40px;">Ending auth</h2>
    <div id="errorMessage" style="font-size: 30px;"></div>
  </head>
  <body>
    <script>
      const params = new URLSearchParams(window.location.search);
      const result = params.get('code');
      const { authId, method, hostName } = JSON.parse(params.get('state'));
      let storedRedirectUrl;

      // Redirect back to Orange host
      if (method === 'deeplink') {
        storedRedirectUrl = sessionStorage.getItem('hostRedirectUrl')
        if (storedRedirectUrl) {
          window.location.href = storedRedirectUrl.replace('{result}',result)
        } else if (hostName === 'Orange') {
          window.location.href = `msorange://testapp.com/auth_callback?authId=${authId}&result=${result}`;
        }
      }
      document.getElementById('errorMessage').innerHTML = `<p>Attempting to redirect back to the App<br>URL: ${window.location.href}<br>hostRedirectUrl=${storedRedirectUrl}</p>`;
    </script>

  </body>
</html>
